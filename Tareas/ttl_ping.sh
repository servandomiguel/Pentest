#!/bin/sh

if [ -z $1 ]
then
	echo "Usage: ./ttl_ping.sh ip|host_name\n"
	exit 1
fi

valida1=`echo $1 | grep -Ex "([0-9]{1,3}\.){3}([0-9]{1,3})"`
valida2=`echo $1 | grep -Ex "([0-9A-Za-z\-\_\.])+"`
echo $valida

if [ -z $valida1 ] && [ -z $valida2 ] 
then
	echo "Parametro incorrecto"
	exit 1
fi

ping_res=`ping -c 1 -i 1 $1`
res="`echo $ping_res | grep '0 received, 100% packet loss'`"

if [ ! -z "`echo $res`" ]
then
	echo "Destination host unreachable"
	exit 1
fi
res="`echo $ping_res | grep -E -o 'ttl\=[0-9]{1,4}' | grep -E -o '[0-9]{1,3}'`"

if [ $res -eq 128 ]
then
	echo "SO: Windows"
elif [ $res -le 64 ] && [ $res -ge 0 ]
then
	echo "SO: Linux"
elif [ $res -eq 255 ] 
then
	echo "SO: Linux"
else
	echo "SO: Unidentified"
fi
